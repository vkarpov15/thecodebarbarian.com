<!DOCTYPE html><html><head><script type="text/javascript">var _sf_startpt=(new Date()).getTime()</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-TE4SWRGR9E"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());

gtag('config', 'G-TE4SWRGR9E');
</script><title>Introducing @datastax/astra-mongoose: The New Way to Use DataStax Astra with Mongoose | www.thecodebarbarian.com</title><meta name="viewport" content="width=device-width, initial-scale=1"><link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Merriweather:400,400italic,600,700" rel="stylesheet" type="text/css"><link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"><link href="/style/style.css" rel="stylesheet" type="text/css"><link href="/style/github.css" rel="stylesheet" type="text/css"><script href="http://code.jquery.com/jquery-2.1.1.min.js" type="text/javascript"></script><script href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js" type="text/javascript"></script><script href="/javascript/sidebar.js" type="text/javascript"></script><meta property="og:title" content="Introducing @datastax/astra-mongoose: The New Way to Use DataStax Astra with Mongoose"><meta property="og:url" content="http://www.thecodebarbarian.com/introducing-astra-mongoose"><meta property="og:image" content="https://codebarbarian-images.s3.us-east-1.amazonaws.com/ChatGPT+Image+May+21%2C+2025%2C+10_46_33+AM.png"><meta property="og:site_name" content="The Code Barbarian"><meta property="description" content="DataStax's new @datastax/astra-mongoose package lets you use the familiar Mongoose ODM with Cassandra databases. This 1.0 release builds on our previous stargate-mongoose work but with improved connectivity through the official Astra DB driver, better TypeScript support, and enhanced support for Cassandra tables."><meta name="twitter:image" content="https://codebarbarian-images.s3.us-east-1.amazonaws.com/ChatGPT+Image+May+21%2C+2025%2C+10_46_33+AM.png"></head><body><div class="navbar social-links hidden-sm hidden-xs"><div class="container"><ul class="nav navbar-nav navbar-right"><li><a href="http://www.twitter.com/code_barbarian">twitter</a></li><li><a href="http://www.github.com/vkarpov15">github</a></li><li><a href="http://thecodebarbarian.com/feed.xml">rss</a></li><li><a href="/recommendations">recommendations</a></li></ul></div></div><div class="navbar" id="nav"><div class="container"><div class="navbar-header"><a class="navbar-brand big-brand" href="http://thecodebarbarian.com"><img class="logo" src="/images/Barbarian_Head.png"><span class="site-name">The Code Barbarian</span></a></div><div class="navbar-right collapse navbar-collapse" id="home-nav-mobile"><ul class="nav navbar-nav"><li><a href="/tag/mongodb.html">MongoDB</a></li><li><a href="/tag/nodejs.html">NodeJS</a></li><li><a href="/tag/asyncawait.html">Async/Await</a></li><li><a href="/tag/vue.html">Vue</a></li><li class="hidden-md hidden-lg"><a href="#">@code_barbarian</a></li><li class="hidden-md hidden-lg"><a href="#">TCB Github</a></li><li class="hidden-md hidden-lg"><a href="#">TCB Facebook</a></li></ul></div></div></div><div class="container-fluid"><div class="col-lg-3 col-lg-offset-9 right-bar" id="desktop-right-bar"><div class="right-bar-content-slider pull-right"><div class="row recent-posts right-bar-group"><div class="col-lg-12 articles"><p class="right-bar-label">Most Popular Articles</p><ul class="list-unstyled"><li class="right-bar-li"><a href="/common-async-await-design-patterns-in-node.js.html">Common Async/Await Design Patterns in Node.js</a></li><li class="right-bar-li"><a href="/unhandled-promise-rejections-in-node.js.html">Unhandled Promise Rejections in Node.js</a></li><li class="right-bar-li"><a href="/using-async-await-with-mocha-express-and-mongoose">Using Async/Await with Mocha, Express, and Mongoose</a></li><li class="right-bar-li"><a href="/write-your-own-node-js-promise-library-from-scratch.html">Write Your Own Node.js Promise Library from Scratch</a></li><li class="right-bar-li"><a href="/80-20-guide-to-express-error-handling">The 80/20 Guide to Express Error Handling</a></li></ul></div></div><div class="row recent-posts right-bar-group"><div class="col-lg-12 books"><p class="right-bar-label">Ebooks<div><a href="http://asyncawait.net/?utm_source=thecodebarbarian&amp;utm_campaign=sidebar"><img src="/images/verticalbanner.png"></a></div><div><a href="http://es2015generators.com"><img src="https://i.imgur.com/xvGNKlr.png"><p><i>The 80/20 Guide to ES2015 Generators</i></p></a></div></p></div></div></div></div></div><div class="container-fluid hidden-sm hidden-md hidden-lg" id="mobile-sharing-options"><div class="row"><div class="col-lg-12"><style>#home-nav-mobile {
  float: left !important;
  margin-left: 215px !important;
}
</style><div class="post-sharing-options"><div class="row"><div class="col-xs-3 twitter-share sharing-option"><a class="social" href="https://twitter.com/share?url=#{encodeURIComponent('http://www.thecodebarbarian.com' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}&amp;via=code_barbarian"><i class="fa fa-twitter"></i></a></div><div class="col-xs-3 facebook-share sharing-option"><a class="social" href="https://www.facebook.com/sharer/sharer.php?u=#{encodeURIComponent('http://www.thecodebarbarian.com/' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}"><i class="fa fa-facebook"></i></a></div><div class="col-xs-3 google-share sharing-option"><a class="social" href="https://plus.google.com/share?url=#{encodeURIComponent('http://www.thecodebarbarian.com/' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}"><i class="fa fa-google-plus"></i></a></div><div class="col-xs-3 comment sharing-option"><a class="social" href="#disqus_thread"><i class="fa fa-comment"></i></a></div></div></div></div></div></div><div class="post-sharing-options hidden-xs pull-left" id="desktop-sharing-options"><ul class="list-unstyled"><li class="twitter-share"><a class="social" href="https://twitter.com/share?url=#{encodeURIComponent('http://www.thecodebarbarian.com' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}&amp;via=code_barbarian"><i class="fa fa-twitter sharing-option"></i></a></li><li class="facebook-share"><a class="social" href="https://www.facebook.com/sharer/sharer.php?u=#{encodeURIComponent('http://www.thecodebarbarian.com/' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}"><i class="fa fa-facebook sharing-option"></i></a></li><li class="google-share"><a class="social" href="https://plus.google.com/share?url=#{encodeURIComponent('http://www.thecodebarbarian.com/' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}"><i class="fa fa-google-plus sharing-option"></i></a></li></ul></div><div class="container"><div class="col-lg-9 post-text"><div class="row"><div class="title-byline-container"><h1 class="post-title">Introducing @datastax/astra-mongoose: The New Way to Use DataStax Astra with Mongoose</h1><div class="credits"><span class="byline">by Valeri Karpov</span><span class="byhandle"><a href="http://www.twitter.com/code_barbarian">@code_barbarian</a></span><span class="bydate">May 27, 2025</span></div></div></div><script type="text/javascript" src="/js/native.js"></script><div><script src="//m.servedby-buysellads.com/monetization.js" type="text/javascript"></script>

<div class="native-banner"></div>
</div><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CKYI5K3Y&placement=thecodebarbariancom" id="_carbonads_js"></script><div class="post-body-text-container"><p>In 2023, we announced that we were working on <a href="/were-working-on-cassandra-support-for-mongoose.html">a Mongoose integration for DataStax&#39;s JSON API project</a>, then called stargate-mongoose, meaning you could use Mongoose to read from and write to <a href="https://cassandra.apache.org/_/index.html">Apache Cassandra</a>.
A few things have happened since then: JSON API was renamed <a href="https://docs.datastax.com/en/astra-db-serverless/api-reference/dataapiclient.html">Data API</a>, Data API gained support for <a href="/rag-vector-search-with-astra-and-mongoose.html">vector search</a>, and Data API has become the recommended interface for Astra&#39;s serverless databases.
Today, we&#39;re pleased to announce the 1.0.0 release of <a href="https://www.npmjs.com/package/@datastax/astra-mongoose"><code>@datastax/astra-mongoose</code></a>, the next iteration of the stargate-mongoose project.</p>
<p>Astra-mongoose makes it easy to build apps that interact with DataStax Astra using Mongoose&#39;s familiar API. Whether you need to pull Astra data into a MongoDB-backed app or looking to simplify your Astra development experience, this release is for you.</p>
<p>Want to jump right in? Here are some resources to get started:</p>
<ul>
<li><a href="https://github.com/stargate/stargate-mongoose-sample-apps">Sample apps repo</a> – now fully migrated to <code>@datastax/astra-mongoose</code> (<a href="https://github.com/stargate/stargate-mongoose-sample-apps/pull/584">PR #584</a>)</li>
<li><a href="https://github.com/vkarpov15/obsidian-astra-semantic-search">Obsidian plugin</a> – sync your Obsidian notes to Astra and perform semantic search with astra-mongoose using Astra&#39;s <code>$vectorize</code> (No additional AI API keys required)</li>
</ul>
<h2 id="whats-changed-in-astra-mongoose">What&#39;s Changed in astra-mongoose</h2>
<p>At a high level, there are 3 major changes in <code>@datastax/astra-mongoose</code>.</p>
<ol>
<li><code>@datastax/astra-mongoose</code> uses Astra&#39;s official Node.js/TypeScript driver <a href="https://www.npmjs.com/package/@datastax/astra-db-ts"><code>@datastax/astra-db-ts</code></a> to connect to Astra. Stargate-mongoose used its own method of connecting to Data API because <code>@datastax/astra-db-ts</code> didn&#39;t exist when stargate-mongoose was first written.</li>
<li><code>@datastax/astra-mongoose</code> is designed to connect primarily to Data API running on DataStax Astra. Stargate-mongoose was geared towards connecting to self-hosted Data API instances.</li>
<li>Better support for Data API&#39;s tables API. More on that in the next section.</li>
</ol>
<p><code>@datastax/astra-mongoose</code> is not a full rewrite of stargate-mongoose. Instead, we simplified and refocused the existing stargate-mongoose code, including ripping out all the low-level connection logic that <code>@datastax/astra-db-ts</code> handles.
The result is a cleaner codebase and more reliable connectivity to Astra&#39;s services.
In addition, we improved TypeScript support and added better error handling to make development with Astra and Mongoose even smoother.</p>
<p>Also, <code>@datastax/astra-mongoose</code> does not mean Mongoose is now a multi-database ORM.
Mongoose is primarily built to work with MongoDB.
Astra-mongoose is a plugin that leverages Mongoose&#39;s driver API, a way to sub out the underlying database driver calls (like <code>find()</code>, <code>findOne()</code>, <code>updateOne()</code>, etc.) that has been part of Mongoose since 2012.
Mongoose&#39;s driver API also powers <a href="https://playground.mongoosejs.io/">Mongoose Playground</a> and <a href="https://github.com/mongoosejs/mongoose-browser">Mongoose 9&#39;s upcoming browser library</a>.</p>
<p>One of the biggest updates in astra-mongoose is better support for Data API&#39;s tables.</p>
<h2 id="using-tables-with-astra-mongoose">Using Tables With Astra-Mongoose</h2>
<p>Stargate-mongoose was also designed primarily to interact with Data API&#39;s <a href="https://docs.datastax.com/en/astra-db-serverless/api-reference/collections.html"><em>collections</em></a>.
Collections are designed to store unstructured data, allowing you to store arbitrary objects with no database schema, similar to MongoDB.
The downside was that, practically speaking, collections are only readable and writeable via Data API: the way collections store data in Cassandra isn&#39;t easily readable by except through Data API.
For example, if you inserted some data into a Cassandra table via a CQL shell, you couldn&#39;t read that data via the collections API.</p>
<p>Data API recently added support for <a href="https://docs.datastax.com/en/astra-db-serverless/api-reference/tables.html"><em>tables</em></a>, which allow you to use Data API to read and write data from existing Cassandra tables.
This means you can use astra-mongoose to build applications on top of existing Cassandra data, even if that data wasn&#39;t originally inserted through Data API.</p>
<p>For example, take a look at <a href="https://github.com/stargate/stargate-mongoose-sample-apps/tree/main/discord-bot">astra-mongoose&#39;s Discord bot sample app</a>.
This app is a simple Discord bot that exposes a <code>/count</code> command which counts the number of documents in a collection (or table), and a <code>/createdocument</code> command which inserts a new document.</p>
<img src="https://i.imgur.com/pjoS1UC.png">

<p>By default, this app uses collections, but you can make it use tables by setting the environment variable <code>DATA_API_TABLES=true</code>.
The <code>DATA_API_TABLES</code> makes 2 changes:</p>
<ol>
<li>Sets the <code>isTable</code> option on <code>mongoose.connect()</code> to tell astra-mongoose to use &quot;tables mode&quot;</li>
<li>Makes the <code>seed.js</code> script use <code>createTable()</code> instead of <code>createCollection()</code>.</li>
</ol>
<p>Data API tables have a strict schema, so when creating a new table you either need to explicitly define the table schema, or use <code>tableDefinitionFromSchema()</code> to get a Data-API-compatible table schema from your Mongoose schema.</p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> { createAstraUri } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'@datastax/astra-mongoose'</span>);
<span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./mongoose'</span>);

<span class="hljs-keyword">const</span> uri = createAstraUri(
  process.env.ASTRA_API_ENDPOINT,
  process.env.ASTRA_APPLICATION_TOKEN,
  process.env.ASTRA_NAMESPACE
);
<span class="hljs-keyword">const</span> jsonApiConnectOptions = {
  isTable: !!process.env.DATA_API_TABLES
};

<span class="hljs-comment">// Connect in tables mode if `DATA_API_TABLES` is set</span>
mongoose.connect(uri, jsonApiConnectOptions);</code></pre>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> Bot = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./models/bot'</span>);
<span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./mongoose'</span>);
<span class="hljs-keyword">const</span> { tableDefinitionFromSchema } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'@datastax/astra-mongoose'</span>);

<span class="hljs-keyword">if</span> (process.env.DATA_API_TABLES) {
  <span class="hljs-comment">// Create a new table instead of a collection.</span>
  <span class="hljs-comment">// Data API tables **must** have a schema. `tableDefinitionFromSchema()` converts</span>
  <span class="hljs-comment">// Mongoose schemas into Data API table schemas.</span>
  <span class="hljs-keyword">await</span> mongoose.connection.createTable(
    Bot.collection.collectionName,
    tableDefinitionFromSchema(Bot.schema)
  );
} <span class="hljs-keyword">else</span> {
  <span class="hljs-keyword">await</span> Bot.createCollection();
}</code></pre>
<p>With the above code, running the <code>/createdocument</code> command in Discord creates a new row in the <code>bots</code> table in Astra that you can then read from the CQL console.
The row has a MongoDB-style <code>_id</code> field and a numeric <code>__v</code> field, which are part of Mongoose&#39;s default schema configuration, but you can also see the <code>name</code> field that the Discord bot sets.
This table is a normal Cassandra table - you can query and manipulate it just like any other Cassandra table using standard CQL commands or other drivers.</p>
<img src="https://i.imgur.com/mcmTv67.png">

<h2 id="moving-on">Moving On</h2>
<p>We&#39;re excited to introduce the fully stable 1.0.0 release of <code>@datastax/astra-mongoose</code>.
Whether you&#39;re building a new application or integrating with an existing Cassandra database, astra-mongoose provides a familiar interface while giving you access to Astra&#39;s capabilities, including vector search for AI applications.</p>
<p>We&#39;d love to hear about what you&#39;re building with astra-mongoose! Drop us a note on <a href="https://github.com/stargate/astra-mongoose-driver">GitHub</a> or reach out on the <a href="https://community.datastax.com/">DataStax community forums</a>.
Try it out and let us know what you think!</p>
</div><div style="color: #666666; border-top: 1px dashed #666666; margin: 25px; text-align: center; padding-top: 10px"><em>Found a typo or error? Open up a pull request! This post is
available as markdown on&nbsp;<a href="https://github.com/vkarpov15/thecodebarbarian.com/blob/master/lib/posts/#{post.src.substr('./lib/posts/'.length)}">Github</a></em></div><div id="disqus_thread"></div><script type="text/javascript">/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'codebarbarian'; // required: replace example with your forum shortname

/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><a class="dsq-brlink" href="http://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a></div></div><div style="padding-bottom: 100px">&nbsp;</div><script type="text/javascript">var xhr = new XMLHttpRequest();
xhr.open('POST', 'https://g0a3nbw0xa.execute-api.us-east-1.amazonaws.com/prod/track', true);
xhr.setRequestHeader('Content-Type', 'application/json');
xhr.onreadystatechange = function() {};
xhr.send(JSON.stringify({
  path: window.location.pathname,
  hostname: window.location.hostname
}));</script><link rel="stylesheet" href="/style/inlinecpc.css"></body></html>