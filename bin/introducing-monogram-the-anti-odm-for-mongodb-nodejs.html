<html><head><script type="text/javascript">var _sf_startpt=(new Date()).getTime()
</script><title>Introducing Monogram, the Anti-ODM for Node.js and MongoDB | www.thecodebarbarian.com</title><meta name="viewport" content="width=device-width, initial-scale=1"/><link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet" type="text/css"/><link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600" rel="stylesheet" type="text/css"/><link href="//fonts.googleapis.com/css?family=Merriweather:400,400italic,600,700" rel="stylesheet" type="text/css"/><link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/><link href="/style/style.css" rel="stylesheet" type="text/css"/><link href="/style/github.css" rel="stylesheet" type="text/css"/><script href="http://code.jquery.com/jquery-2.1.1.min.js" type="text/javascript"></script><script href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js" type="text/javascript"></script><script href="/javascript/sidebar.js" type="text/javascript"></script><meta property="og:title" content="Introducing Monogram, the Anti-ODM for Node.js and MongoDB"/><meta property="og:url" content="http://www.thecodebarbarian.com/introducing-monogram-the-anti-odm-for-mongodb-nodejs"/><meta property="og:image" content="http://i.imgur.com/DrY1SiZ.jpg"/><meta property="og:site_name" content="The Code Barbarian"/></head><body><div class="navbar social-links hidden-sm hidden-xs"><div class="container"><ul class="nav navbar-nav navbar-right"><li><a href="http://www.twitter.com/code_barbarian">twitter</a></li><li><a href="http://www.github.com/vkarpov15">github</a></li><li><a href="http://thecodebarbarian.com/feed.xml">rss</a></li></ul></div></div><div id="nav" class="navbar"><div class="container"><div class="navbar-header"><a href="http://thecodebarbarian.com" class="navbar-brand big-brand"><img src="/images/Barbarian_Head.png" class="logo"/><span class="site-name">The Code Barbarian</span></a></div><div id="home-nav-mobile" class="navbar-right collapse navbar-collapse"><ul class="nav navbar-nav"><li><a href="http://thecodebarbarian.com/tag/mongodb.html">MongoDB</a></li><li><a href="http://thecodebarbarian.com/tag/angularjs.html">AngularJS</a></li><li><a href="http://thecodebarbarian.com/tag/nodejs.html">NodeJS</a></li><li><a href="http://thecodebarbarian.com/tag/paleo.html">Paleo</a></li><li class="hidden-md hidden-lg"><a href="#">@code_barbarian</a></li><li class="hidden-md hidden-lg"><a href="#">TCB Github</a></li><li class="hidden-md hidden-lg"><a href="#">TCB Facebook</a></li></ul></div></div></div><div class="container-fluid"><div id="desktop-right-bar" class="col-lg-3 col-lg-offset-9 right-bar"><div class="right-bar-content-slider pull-right"><div class="row search-container"><div class="col-lg-12"><div class="form-group"></div><label>Search</label><form onsubmit="window.location.href = 'https://www.google.im/search?q=' + encodeURIComponent(document.getElementById('searchQ').value) + '+site:thecodebarbarian.com'; return false;"><div class="input-group"><input id="searchQ" type="text" class="form-control"/><div class="input-group-addon search-button"><i class="fa fa-search"></i></div></div></form></div></div><div class="row recent-posts right-bar-group"><div class="col-lg-12 books"><div><a href="http://es2015generators.com"><img src="https://i.imgur.com/xvGNKlr.png"/></a></div><div><script type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&amp;serve=C6AILKT&amp;placement=thecodebarbariancom" id="_carbonads_js"></script></div></div></div><div class="row recent-posts right-bar-group"><div class="col-lg-12"><p class="right-bar-label">Most Popular</p><ul class="list-unstyled"><li class="right-bar-li"><a href="http://thecodebarbarian.com/common-async-await-design-patterns-in-node.js.html">Common Async/Await Design Patterns in Node.js</a></li><li class="right-bar-li"><a href="http://thecodebarbarian.com/unhandled-promise-rejections-in-node.js.html">Unhandled Promise Rejections in Node.js</a></li><li class="right-bar-li"><a href="http://thecodebarbarian.com/80-20-guide-to-async-await-in-node.js.html">The 80/20 Guide to Async/Await in Node.js</a></li><li class="right-bar-li"><a href="http://thecodebarbarian.com/getting-started-with-webassembly-in-node.js.html">Getting Started With WebAssembly in Node.js</a></li><li class="right-bar-li"><a href="http://thecodebarbarian.com/2015/01/24/angularjs-interceptors.html">An 80/20 Guide to AngularJS HTTP Interceptors</a></li></ul></div></div></div></div></div><div id="mobile-sharing-options" class="container-fluid hidden-sm hidden-md hidden-lg"><div class="row"><div class="col-lg-12"><div class="post-sharing-options"><div class="row"><div class="col-xs-3 twitter-share sharing-option"><a href="https://twitter.com/share?url=http%3A%2F%2Fwww.thecodebarbarian.com%2Fintroducing-monogram-the-anti-odm-for-mongodb-nodejs&amp;via=code_barbarian" class="social"><i class="fa fa-twitter"></i></a></div><div class="col-xs-3 facebook-share sharing-option"><a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.thecodebarbarian.com%2F%2Fintroducing-monogram-the-anti-odm-for-mongodb-nodejs" class="social"><i class="fa fa-facebook"></i></a></div><div class="col-xs-3 google-share sharing-option"><a href="https://plus.google.com/share?url=http%3A%2F%2Fwww.thecodebarbarian.com%2F%2Fintroducing-monogram-the-anti-odm-for-mongodb-nodejs" class="social"><i class="fa fa-google-plus"></i></a></div><div class="col-xs-3 comment sharing-option"><a href="#disqus_thread" class="social"><i class="fa fa-comment"></i></a></div></div></div></div></div></div><div id="desktop-sharing-options" class="post-sharing-options hidden-xs pull-left"><ul class="list-unstyled"><li class="twitter-share"><a href="https://twitter.com/share?url=http%3A%2F%2Fwww.thecodebarbarian.com%2Fintroducing-monogram-the-anti-odm-for-mongodb-nodejs&amp;via=code_barbarian" class="social"><i class="fa fa-twitter sharing-option"></i></a></li><li class="facebook-share"><a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.thecodebarbarian.com%2F%2Fintroducing-monogram-the-anti-odm-for-mongodb-nodejs" class="social"><i class="fa fa-facebook sharing-option"></i></a></li><li class="google-share"><a href="https://plus.google.com/share?url=http%3A%2F%2Fwww.thecodebarbarian.com%2F%2Fintroducing-monogram-the-anti-odm-for-mongodb-nodejs" class="social"><i class="fa fa-google-plus sharing-option"></i></a></li></ul></div><div class="container"><div class="col-lg-9 post-text"><div class="row"><div class="title-byline-container"><h1 class="post-title">Introducing Monogram, the Anti-ODM for Node.js and MongoDB</h1><div class="credits"><span class="byline">by Valeri Karpov</span><span class="byhandle"><a href="http://www.twitter.com/code_barbarian">@code_barbarian</a></span><span class="bydate">July 21, 2017</span></div></div></div><div class="post-body-text-container"><p>In 2015, I <a href="https://github.com/vkarpov15/monogram-old/graphs/contributors">started working on a new ODM</a> for MongoDB and Node.js. It was based on <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/observe">the now-obsolete <code>Object.observe()</code> function</a>, and I unfortunately had to scrap the whole project when the <code>Object.observe()</code> proposal was unexpectedly withdrawn. A lot of the core logic from the original ODM lives on in <a href="https://www.npmjs.com/package/archetype-js">Archetype</a>. But my brief time in <a href="https://thinkster.io/tutorials/build-a-real-world-react-redux-application">Redux land</a> and studying <a href="https://www.npmjs.com/package/falcor">falcor</a> taught me a crucial lesson: the Model-View-Controller paradigm is not the only way to do things. MVC and ODMs still make sense, but we can build a stronger, more functional abstraction as the basis for a more concise architecture. The <a href="https://www.npmjs.com/package/monogram">new monogram</a> has now been powering 100% of <a href="https://www.trybooster.com/careers">Booster&#39;s</a> API queries for weeks and it&#39;s officially production ready. Here&#39;s what monogram is all about.</p>
<h2 id="function-calls-are-objects">Function Calls are Objects</h2>
<p>The mind-bending idea that <a href="https://maetl.net/talks/rise-and-fall-of-orm">made ORMs so popular in the late 90&#39;s and early 2000&#39;s</a> was that you could merge object-oriented programming with RDBMS by mapping objects in your programming language of choice (typically Java for early ORMs) to rows in your database. In other words, an ORM let you think of database rows as objects, and the MongoDB equivalent ODM lets you think of MongoDB documents as objects. Unfortunately, even with <code>Object.observe()</code> it&#39;s tricky to <a href="http://mongoosejs.com/docs/faq.html">get this mapping right in the general case</a> because of in-place updates, not to mention <a href="http://aaronheckmann.blogspot.com/2012/06/mongoose-v3-part-1-versioning.html">the difficulties of distributed programming</a>.</p>
<p>What if, instead of mapping documents to objects, we mapped database operations to objects? What if, instead of scratching our heads about how to make arrays and dates a nail for the OOP hammer, we took a page out of <a href="https://en.wikipedia.org/wiki/Aspect-oriented_programming">aspect-oriented programming&#39;s</a> book and thought about how to better instrument our database operations? The key idea of monogram is that every function call on a <a href="http://mongodb.github.io/node-mongodb-native/2.2/api/Collection.html">MongoDB collection</a> can be represented as an object that we call an <em>action</em>.</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> { connect } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'monogram'</span>);

test().catch(error =&gt; <span class="hljs-built_in">console</span>.error(error.stack));

<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">test</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">const</span> db = <span class="hljs-keyword">await</span> connect(<span class="hljs-string">'mongodb://localhost:27017/test'</span>);

  <span class="hljs-keyword">const</span> Test = db.collection(<span class="hljs-string">'Test'</span>);

  Test.pre(action =&gt; {
    <span class="hljs-comment">/* Here's what an action looks like:
     * { _id: 59722626c9d79b6d1cbe0387,
     *   params: [ { hello: 'world' } ],
     *   collection: 'Test',
     *   name: 'insertOne',
     *   chained: [] }
     */</span>
    <span class="hljs-built_in">console</span>.log(action);
  });

  <span class="hljs-keyword">await</span> Test.insertOne({ hello: <span class="hljs-string">'world'</span> });
}
</code></pre>
<p>Monogram defines actions for every <a href="https://github.com/mongodb/specifications/blob/master/source/crud/crud.rst#operations">operation in the MongoDB CRUD spec</a>. This certainly makes logging easy, the above code is all you need to log every single database operation to the console. When you attach middleware to your collection like above, your middleware executes <strong>before</strong> the actual database function executes. In other words, the <code>console.log()</code> above happens before the <code>insertOne()</code> gets sent out to MongoDB. What about if you wanted to print out how long each operation took?</p>
<h2 id="rxjs-observable-of-actions">RxJS Observable of Actions</h2>
<p>One idea that&#39;s been proposed as an alternative to <code>Object.observe()</code> is the <a href="https://github.com/tc39/proposal-observable">Observable proposal</a> and <a href="https://www.npmjs.com/package/rxjs">RxJS</a>. Observables are a completely different construct in that they do <strong>not</strong> listen for changes on objects. They&#39;re just streams of objects that you can <code>filter()</code>, <code>map()</code>, <code>merge()</code>, etc. Observables would not serve as the basis for a change-tracking system for an ODM, but they work great as a <a href="http://thecodebarbarian.com/rest-apis-with-observables">middleware mechanism for action streams</a>.</p>
<p>Monogram collections have an <code>action$</code> stream that represents every function call you make on that collection:</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> { connect } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'monogram'</span>);

test().catch(error =&gt; <span class="hljs-built_in">console</span>.error(error.stack));

<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">test</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">const</span> db = <span class="hljs-keyword">await</span> connect(<span class="hljs-string">'mongodb://localhost:27017/test'</span>);

  <span class="hljs-keyword">const</span> Test = db.collection(<span class="hljs-string">'Test'</span>);

  Test.action$.subscribe(action =&gt; {
    <span class="hljs-comment">/* Prints the below object. Note the `promise` property!
     * { _id: 5972314216958974eeadf4e3,
     *   params: [ { hello: 'world', _id: 5972314216958974eeadf4e4 } ],
     *   collection: 'Test',
     *   name: 'insertOne',
     *   chained: [],
     *   promise: Promise { &lt;pending&gt; } }
     */</span>
    <span class="hljs-built_in">console</span>.log(action);
  });

  <span class="hljs-keyword">await</span> Test.insertOne({ hello: <span class="hljs-string">'world'</span> });
}
</code></pre>
<p>Monogram added <code>promise</code> property to the action object. This promise is the return value of the native MongoDB driver&#39;s <a href="http://mongodb.github.io/node-mongodb-native/2.2/api/Collection.html#insertOne"><code>insertOne()</code> function</a>. You can use this promise in the subscribe callback to print out each database operation and how long it took.</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> { connect } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'monogram'</span>);

test().catch(error =&gt; <span class="hljs-built_in">console</span>.error(error.stack));

<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">test</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">const</span> db = <span class="hljs-keyword">await</span> connect(<span class="hljs-string">'mongodb://localhost:27017/test'</span>);

  <span class="hljs-keyword">const</span> Test = db.collection(<span class="hljs-string">'Test'</span>);

  Test.action$.subscribe(({ collection, name, promise }) =&gt; {
    <span class="hljs-keyword">const</span> start = <span class="hljs-built_in">Date</span>.now();
    <span class="hljs-comment">// Prints "Test.insertOne() 12ms"</span>
    promise.
      then(() =&gt; { <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`<span class="hljs-subst">${collection}</span>.<span class="hljs-subst">${name}</span>() <span class="hljs-subst">${Date.now() - start}</span>ms`</span>); }).
      <span class="hljs-keyword">catch</span>(() =&gt; { <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`<span class="hljs-subst">${collection}</span>.<span class="hljs-subst">${name}</span>() ERROR`</span>); });
  });

  <span class="hljs-keyword">await</span> Test.insertOne({ hello: <span class="hljs-string">'world'</span> });
}
</code></pre>
<p>Actions are such a powerful abstraction because they always have the same form. In <a href="http://npmjs.org/package/mongoose">mongoose</a>, <a href="http://mongoosejs.com/docs/middleware.html">middleware</a> comes in a <a href="https://en.wikipedia.org/wiki/M%C3%B6tley_Cr%C3%BCe">motley crew</a> of forms. It&#39;s easy to add a <code>pre(&#39;save&#39;)</code> hook, but it&#39;s hard to log every single operation or have common logic that works with both <code>pre(&#39;save&#39;)</code> and <code>pre(&#39;find&#39;)</code>. In monogram, every action has the same properties and goes through the same pipeline, so actions are easier to instrument. And, because they&#39;re easier to instrument, they&#39;re also easier to mutate.</p>
<h2 id="mutating-actions">Mutating Actions</h2>
<p>You might wonder why there&#39;s the <code>pre()</code> middleware function and an observable of actions. The reason is similar to the difference between <a href="https://github.com/Reactive-Extensions/RxJS/blob/master/doc/gettingstarted/creating.md">hot and cold observables</a>. Once an action is assigned a <code>promise</code> property, you can no longer mutate or cancel that action, it&#39;s already in flight. You can mutate the promise and the action object, but that won&#39;t affect what gets sent to the database. In <code>pre()</code>, however, you can do whatever you want to the action object. For example, you can disallow deleting documents:</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> { connect } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'monogram'</span>);

test().catch(error =&gt; <span class="hljs-built_in">console</span>.error(error.stack));

<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">test</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">const</span> db = <span class="hljs-keyword">await</span> connect(<span class="hljs-string">'mongodb://localhost:27017/test'</span>);

  <span class="hljs-keyword">const</span> Test = db.collection(<span class="hljs-string">'Test'</span>);

  Test.pre(<span class="hljs-regexp">/delete/</span>, action =&gt; {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Deletes are not allowed!'</span>);
  });

  <span class="hljs-comment">// Throws an error "Deletes are not allowed!"</span>
  <span class="hljs-keyword">await</span> Test.deleteOne({ hello: <span class="hljs-string">'world'</span> });
}
</code></pre>
<p>How about if you wanted to transparently support <a href="https://www.npmjs.com/package/mongoose-delete">soft deletes</a> rather than throw an error if a developer tries to <code>deleteOne()</code>? That&#39;s easy too. You can transform the action object in <code>pre()</code> middleware. You can change the parameters and even the function that will get called:</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">test</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">const</span> db = <span class="hljs-keyword">await</span> connect(<span class="hljs-string">'mongodb://localhost:27017/test'</span>);

  <span class="hljs-keyword">const</span> Test = db.collection(<span class="hljs-string">'Test'</span>);

  Test.pre(<span class="hljs-regexp">/delete/</span>, action =&gt; {
    <span class="hljs-comment">// deleteOne -&gt; updateOne, deleteMany -&gt; updateMany</span>
    action.name = action.name.replace(<span class="hljs-regexp">/delete/</span>, <span class="hljs-string">'update'</span>);
    <span class="hljs-keyword">if</span> (action.params.length &lt; <span class="hljs-number">1</span>) {
      action.params.push({});
    }
    <span class="hljs-comment">// Deletes transparently become updates that set an `isDeleted` flag</span>
    action.params.push({ $set: { isDeleted: <span class="hljs-literal">true</span> } });
    <span class="hljs-keyword">return</span> action;
  });

  <span class="hljs-comment">// Log actions to the console for educational purposes</span>
  Test.action$.subscribe(action =&gt; {
    <span class="hljs-built_in">console</span>.log(inspect(action, { depth: <span class="hljs-number">10</span> }));
  });

  <span class="hljs-comment">/* Prints:
   * { _id: 597242530620367e5dfa4afa,
   *   params: [ { hello: 'world', _id: 597242530620367e5dfa4afb } ],
   *   collection: 'Test',
   *   name: 'insertOne',
   *   chained: [],
   *   promise: Promise { &lt;pending&gt; } }
   */</span>
  <span class="hljs-keyword">await</span> Test.insertOne({ hello: <span class="hljs-string">'world'</span> });

  <span class="hljs-comment">/* This becomes an `updateOne()` under the hood!
   * { _id: 597242540620367e5dfa4afc,
   *   params: [ {}, { '$set': { isDeleted: true } } ],
   *   collection: 'Test',
   *   name: 'updateOne',
   *   chained: [],
   *   promise: Promise { &lt;pending&gt; } }
   */</span>
  <span class="hljs-keyword">await</span> Test.deleteOne();
}
</code></pre>
<p>What about backing up deleted documents to a separate collection? This has always been tricky since <a href="https://docs.mongodb.com/manual/reference/method/db.collection.copyTo/">MongoDB deprecated <code>copyTo()</code></a>, but monogram makes this easy too:</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">test</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">const</span> db = <span class="hljs-keyword">await</span> connect(<span class="hljs-string">'mongodb://localhost:27017/test'</span>);

  <span class="hljs-keyword">const</span> Test = db.collection(<span class="hljs-string">'Test'</span>);
  <span class="hljs-keyword">const</span> TestBackup = db.collection(<span class="hljs-string">'TestBackup'</span>);

  Test.pre(<span class="hljs-string">'deleteOne'</span>, <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">action</span>) </span>{
    <span class="hljs-keyword">const</span> doc = <span class="hljs-keyword">await</span> Test.findOne(action.params[<span class="hljs-number">0</span>]);
    <span class="hljs-keyword">if</span> (doc) {
      <span class="hljs-keyword">await</span> TestBackup.insertOne(doc);
    }
    <span class="hljs-keyword">return</span> action;
  });

  Test.action$.subscribe(({ collection, name }) =&gt; {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`<span class="hljs-subst">${collection}</span>.<span class="hljs-subst">${name}</span>()`</span>);
  });

  TestBackup.action$.subscribe(({ collection, name }) =&gt; {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`<span class="hljs-subst">${collection}</span>.<span class="hljs-subst">${name}</span>()`</span>);
  });

  <span class="hljs-comment">// Test.insertOne()</span>
  <span class="hljs-keyword">await</span> Test.insertOne({ hello: <span class="hljs-string">'world'</span> });
  <span class="hljs-comment">/*
   * Test.findOne()
   * TestBackup.insertOne()
   * Test.deleteOne()
   */</span>
  <span class="hljs-keyword">await</span> Test.deleteOne();
}
</code></pre>
<h2 id="moving-on">Moving On</h2>
<p>Monogram is a potent abstraction for both advanced and novice users of MongoDB and Node.js. From logging to soft deletes to <a href="https://github.com/vkarpov15/monogram#enforcing-internal-best-practices">enforcing best practices</a> to distributed locking, monogram makes instrumenting logic and handling <a href="https://en.wikipedia.org/wiki/Cross-cutting_concern">cross-cutting concerns</a> easy. Give it a shot and open up any issues you find on <a href="https://github.com/vkarpov15/monogram/issues">GitHub</a>.</p>
</div><div><div class="native-js">
  <script type="text/javascript" src="/js/native.js"></script>
  <script type="text/javascript">
    _native.init('CK7DT53N', {
      targetClass: 'native-js',
      fallback: `
        <a href="#" class="native-flex">
          <style>
            .native-js {
              background: linear-gradient(-30deg, #DA3925E5, #DA3925E5 45%, #DA3925 45%) #fff;
            }
            
            .native-details {
              color: #FFFFFF !important;
            }
            
            .native-details:hover {
              color: #FFFFFF !important;
            }
            
            .native-cta {
              color: #FFFFFF;
              background-color: #626469;
            }
            
            .native-cta:hover {
              color: #native_cta_color_hover;
              background-color: #626469;
            }
          </style>
          <div class="native-main">
            <img class="native-img" src="https://cdn4.buysellads.net/uu/1/2144/1520557245-ShutterstockIcon_250x100__1_.jpg">
            <div class="native-details">
              <span class="native-company">Fallback Company</span>
              <span class="native-desc">This is a sample of using fallback ads.</span>
            </div>
          </div>
          <span class="native-cta">Fallback CTA</span>
        </a>
      `
    });
  </script>
  <a href="#native_link#" class="native-flex">
    <style>
      .native-js {
        background: linear-gradient(-30deg, #native_bg_color#E5, #native_bg_color#E5 45%, #native_bg_color# 45%) #fff;
      }
      
      .native-details {
        color: #native_color# !important;
      }
      
      .native-details:hover {
        color: #native_color_hover# !important;
      }
      
      .native-cta {
        color: #native_cta_color#;
        background-color: #native_cta_bg_color#;
      }
      
      .native-cta:hover {
        color: #native_cta_color_hover;
        background-color: #native_cta_bg_color_hover#;
      }
    </style>
    <div class="native-main">
      <img class="native-img" src="#native_logo#">
      <div class="native-details">
        <span class="native-company">#native_company#</span>
        <span class="native-desc">#native_desc#</span>
      </div>
    </div>
    <span class="native-cta">#native_cta#</span>
  </a>
</div>
</div><div style="color: #666666; border-top: 1px dashed #666666; margin: 25px; text-align: center; padding-top: 10px"><em>Found a typo or error? Open up a pull request! This post is
available as markdown on&nbsp;<a href="https://github.com/vkarpov15/thecodebarbarian.com/blob/master/lib/posts/20170721_monogram.md">Github</a></em></div><div id="disqus_thread"></div><script type="text/javascript">/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'codebarbarian'; // required: replace example with your forum shortname

/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a></div></div><div style="padding-bottom: 100px">&nbsp;</div><script type="text/javascript">!function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","group","track","ready","alias","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="3.0.1";
  analytics.load("5DErrxzVhprg8sNh8xaiKDR6dNa7yGTI");
  analytics.page()
}}();</script><script type="text/javascript">analytics.track('opened post',
  { title: "Introducing Monogram, the Anti-ODM for Node.js and MongoDB", time: new Date() });
  </script></body></html>