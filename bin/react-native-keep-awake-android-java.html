<html><head><script type="text/javascript">var _sf_startpt=(new Date()).getTime()
</script><title>Diving Into React Native Java to Keep the Android Screen On | www.thecodebarbarian.com</title><meta name="viewport" content="width=device-width, initial-scale=1"/><link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet" type="text/css"/><link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600" rel="stylesheet" type="text/css"/><link href="//fonts.googleapis.com/css?family=Merriweather:400,400italic,600,700" rel="stylesheet" type="text/css"/><link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/><link href="/style/style.css" rel="stylesheet" type="text/css"/><link href="/style/github.css" rel="stylesheet" type="text/css"/><script href="http://code.jquery.com/jquery-2.1.1.min.js" type="text/javascript"></script><script href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js" type="text/javascript"></script><script href="/javascript/sidebar.js" type="text/javascript"></script><meta property="og:title" content="Diving Into React Native Java to Keep the Android Screen On"/><meta property="og:url" content="http://www.thecodebarbarian.com/react-native-keep-awake-android-java"/><meta property="og:image" content="http://i.imgur.com/noFg1sU.png"/><meta property="og:site_name" content="The Code Barbarian"/></head><body><div class="navbar social-links hidden-sm hidden-xs"><div class="container"><ul class="nav navbar-nav navbar-right"><li><a href="http://www.twitter.com/code_barbarian">twitter</a></li><li><a href="http://www.github.com/vkarpov15">github</a></li><li><a href="http://thecodebarbarian.com/feed.xml">rss</a></li></ul></div></div><div id="nav" class="navbar"><div class="container"><div class="navbar-header"><a href="http://thecodebarbarian.com" class="navbar-brand big-brand"><img src="/images/Barbarian_Head.png" class="logo"/><span class="site-name">The Code Barbarian</span></a></div><div id="home-nav-mobile" class="navbar-right collapse navbar-collapse"><ul class="nav navbar-nav"><li><a href="http://thecodebarbarian.com/tag/mongodb.html">MongoDB</a></li><li><a href="http://thecodebarbarian.com/tag/angularjs.html">AngularJS</a></li><li><a href="http://thecodebarbarian.com/tag/nodejs.html">NodeJS</a></li><li><a href="http://thecodebarbarian.com/tag/paleo.html">Paleo</a></li><li class="hidden-md hidden-lg"><a href="#">@code_barbarian</a></li><li class="hidden-md hidden-lg"><a href="#">TCB Github</a></li><li class="hidden-md hidden-lg"><a href="#">TCB Facebook</a></li></ul></div></div></div><div class="container-fluid"><div id="desktop-right-bar" class="col-lg-3 col-lg-offset-9 right-bar"><div class="right-bar-content-slider pull-right"><div class="row search-container"><div class="col-lg-12"><div class="form-group"></div><label>Search</label><form onsubmit="window.location.href = 'https://www.google.im/search?q=' + encodeURIComponent(document.getElementById('searchQ').value) + '+site:thecodebarbarian.com'; return false;"><div class="input-group"><input id="searchQ" type="text" class="form-control"/><div class="input-group-addon search-button"><i class="fa fa-search"></i></div></div></form></div></div><div class="row recent-posts right-bar-group"><div class="col-lg-12 books"><div><a href="https://www.patreon.com/codebarbarian"><img src="https://i.imgur.com/48Z01Md.png"/></a></div><div><a href="http://es2015generators.com"><img src="https://i.imgur.com/xvGNKlr.png"/></a></div><div><script type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&amp;serve=C6AILKT&amp;placement=thecodebarbariancom" id="_carbonads_js"></script></div></div></div><div class="row recent-posts right-bar-group"><div class="col-lg-12"><p class="right-bar-label">All Time Most Popular</p><ul class="list-unstyled"><li class="right-bar-li"><a href="http://thecodebarbarian.com/2015/01/24/angularjs-interceptors.html">An 80/20 Guide to AngularJS HTTP Interceptors</a></li><li class="right-bar-li"><a href="http://thecodebarbarian.com/2015/01/17/angularjs-loopback.html">Creating REST APIs and Clients with LoopBack and AngularJS</a></li><li class="right-bar-li"><a href="http://thecodebarbarian.com/cursors-in-mongoose-45">Cursors in Mongoose 4.5</a></li><li class="right-bar-li"><a href="http://thecodebarbarian.com/2015/03/20/callback-hell-is-a-myth">Callback Hell is a Myth</a></li><li class="right-bar-li"><a href="http://thecodebarbarian.com/2015/06/12/testing-angularjs-directives">Testing AngularJS Directives</a></li></ul></div></div></div></div></div><div id="mobile-sharing-options" class="container-fluid hidden-sm hidden-md hidden-lg"><div class="row"><div class="col-lg-12"><div class="post-sharing-options"><div class="row"><div class="col-xs-3 twitter-share sharing-option"><a href="https://twitter.com/share?url=http%3A%2F%2Fwww.thecodebarbarian.com%2Freact-native-keep-awake-android-java&amp;via=code_barbarian" class="social"><i class="fa fa-twitter"></i></a></div><div class="col-xs-3 facebook-share sharing-option"><a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.thecodebarbarian.com%2F%2Freact-native-keep-awake-android-java" class="social"><i class="fa fa-facebook"></i></a></div><div class="col-xs-3 google-share sharing-option"><a href="https://plus.google.com/share?url=http%3A%2F%2Fwww.thecodebarbarian.com%2F%2Freact-native-keep-awake-android-java" class="social"><i class="fa fa-google-plus"></i></a></div><div class="col-xs-3 comment sharing-option"><a href="#disqus_thread" class="social"><i class="fa fa-comment"></i></a></div></div></div></div></div></div><div id="desktop-sharing-options" class="post-sharing-options hidden-xs pull-left"><ul class="list-unstyled"><li class="twitter-share"><a href="https://twitter.com/share?url=http%3A%2F%2Fwww.thecodebarbarian.com%2Freact-native-keep-awake-android-java&amp;via=code_barbarian" class="social"><i class="fa fa-twitter sharing-option"></i></a></li><li class="facebook-share"><a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.thecodebarbarian.com%2F%2Freact-native-keep-awake-android-java" class="social"><i class="fa fa-facebook sharing-option"></i></a></li><li class="google-share"><a href="https://plus.google.com/share?url=http%3A%2F%2Fwww.thecodebarbarian.com%2F%2Freact-native-keep-awake-android-java" class="social"><i class="fa fa-google-plus sharing-option"></i></a></li></ul></div><div class="container"><div class="col-lg-9 post-text"><div class="row"><div class="title-byline-container"><h1 class="post-title">Diving Into React Native Java to Keep the Android Screen On </h1><div class="credits"><span class="byline">by Valeri Karpov</span><span class="byhandle"><a href="http://www.twitter.com/code_barbarian">@code_barbarian</a></span><span class="bydate">February 26, 2016</span></div></div></div><div class="post-body-text-container"><p><a href="https://www.npmjs.com/package/react-native">React Native</a> is hot right now,
and with good reason. Unlike <a href="https://www.npmjs.com/package/cordova">Cordova</a>
or <a href="https://developers.google.com/web/progressive-web-apps?hl=en">progressive web apps</a>,
React Native enables you to build fully native mobile apps in JavaScript.
In other words, your React code controls the layout of the same native Android
(or iOS, if that&#39;s your style) buttons and views. Furthermore, unlike
<a href="http://docs.nativescript.org/start/getting-started">NativeScript</a>, React
Native lets you define styles and layouts entirely in JSX, rather than relying
on XML and a subset of CSS.</p>
<p>I recently set out to see what all the hype was about and built my first React
Native app: <a href="https://github.com/vkarpov15/openHIIT">openHIIT</a>, a timer for
<a href="https://en.wikipedia.org/wiki/High-intensity_interval_training#Tabata_regimen">Tabata-style interval training</a>. It won&#39;t be available on the Play Store, but you can
<a href="https://github.com/vkarpov15/openHIIT/releases">download the apk</a> on GitHub. In
my experience, React Native is far from a complete solution for abstracting
away the underlying OS. Unlike my experiences with
<a href="http://ionicframework.com/">Ionic</a>, I found myself digging into the Java
code regularly with React Native. Right now, there is no way to do basic tasks
like <a href="https://www.npmjs.com/package/react-native-sound">playing audio</a>,
setting Android&#39;s <code>KEEP_SCREEN_ON</code> flag, or even setting the app&#39;s name and
icon, without diving into React Native&#39;s underlying Java code.</p>
<p>In this post, I&#39;ll quickly describe how to make sure Android never puts the
phone to sleep while your app is running. This may seem like a simple task,
but there&#39;s
<a href="http://stackoverflow.com/questions/32704336/how-to-access-activity-from-a-react-native-android-module">plenty of questions about this topic and corresponding bad advice on StackOverflow</a>. I quickly realized during my first
workout that this feature was necessary for the app, but ended up spending
hours figuring out how to get this to work. Hopefully this quick post
will save you some time.</p>
<h2 id="react-native-android-project-layout">React Native Android Project Layout</h2>
<p><em>TLDR; <a href="https://github.com/vkarpov15/openHIIT/commit/c48d7a75d2010d933acdda2fbff862fc4d9a1c2f">diff on GitHub</a></em></p>
<p>Below is the basic layout of the Android project for openHIIT with React Native 0.19.0.</p>
<p><img src="http://i.imgur.com/zAMDVMb.png"></p>
<p>A lot of this code is just build logic automatically generated by React Native
that you never have to touch. However, in my experience, just about every app
will have to make modifications to the <code>android/app/src/main</code> directory.
For instance, any fonts that you want to use in your app need to be included
as ttf files in <code>android/app/src/main/assets/fonts</code>.</p>
<p>The most important file, however, is the <code>MainActivity.java</code> file highlighted
above. In Android, an <strong>activity</strong> is the code organizational unit immediately
underneath an app - all Android code starts in an activity. If you&#39;re not
familiar with Android development, you can think of an activity as being
roughly analogous to a component in React. By default, React Native projects
have only one activity, whose responsibility is rendering whatever the output
of your React components is. In order to keep Android awake while your app
is up, you&#39;re going to modify <code>MainActivity.java</code>.</p>
<h2 id="tweaking-mainactivity-java-">Tweaking <code>MainActivity.java</code></h2>
<p>Android activities have lifecycle hooks much like React components. Since
<code>MainActivity</code> needs to run before any React Native components get rendered,
the <a href="http://developer.android.com/reference/android/app/Activity.html"><code>onCreate()</code> method</a> is
the right place to tell Android to keep your app awake. So all you need to
do is import a couple files and override the <code>onCreate()</code> method for your
<code>MainActivity</code> to set the <code>KEEP_SCREEN_ON</code> flag correctly.</p>
<p><img src="http://i.imgur.com/Z7yDSka.png"></p>
<h2 id="moving-on">Moving On</h2>
<p>React Native is powerful, but in order to use it in any meaningful way on
Android, you need to be willing to get your hands dirty and dig into the
Java. Some surprisingly basic tasks can&#39;t be done through JS, including
forcing the screen to stay on. Writing React Native code is a lot easier
than building a native android app from scratch, but you still need to
be familiar with the basics of native android development before setting
out to build a React Native app.</p>
</div><div style="color: #666666; border-top: 1px dashed #666666; margin: 25px; text-align: center; padding-top: 10px"><em>Found a typo or error? Open up a pull request! This post is
available as markdown on&nbsp;<a href="https://github.com/vkarpov15/thecodebarbarian.com/blob/master/lib/posts/20160226_react_native.md">Github</a></em></div><div id="disqus_thread"></div><script type="text/javascript">/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'codebarbarian'; // required: replace example with your forum shortname

/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a></div></div><div style="padding-bottom: 100px">&nbsp;</div><script type="text/javascript">!function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","group","track","ready","alias","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="3.0.1";
  analytics.load("5DErrxzVhprg8sNh8xaiKDR6dNa7yGTI");
  analytics.page()
}}();</script><script type="text/javascript">analytics.track('opened post',
  { title: "Diving Into React Native Java to Keep the Android Screen On", time: new Date() });
  </script></body></html>