<!DOCTYPE html><html><head><script type="text/javascript">var _sf_startpt=(new Date()).getTime()
</script><title>3 Neat Tricks With npm run | www.thecodebarbarian.com</title><meta name="viewport" content="width=device-width, initial-scale=1"><link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Merriweather:400,400italic,600,700" rel="stylesheet" type="text/css"><link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"><link href="/style/style.css" rel="stylesheet" type="text/css"><link href="/style/github.css" rel="stylesheet" type="text/css"><script href="http://code.jquery.com/jquery-2.1.1.min.js" type="text/javascript"></script><script href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js" type="text/javascript"></script><script href="/javascript/sidebar.js" type="text/javascript"></script><meta property="og:title" content="3 Neat Tricks With npm run"><meta property="og:url" content="http://www.thecodebarbarian.com/3-neat-tricks-with-npm-run"><meta property="og:image" content="http://i.imgur.com/eTsJfMF.jpg"><meta property="og:site_name" content="The Code Barbarian"><meta property="description" content="The `npm run` shortcut is useful for more than just running tests. Here's 3 ways `npm run` can make your life easier."></head><body><div class="navbar social-links hidden-sm hidden-xs"><div class="container"><ul class="nav navbar-nav navbar-right"><li><a href="http://www.twitter.com/code_barbarian">twitter</a></li><li><a href="http://www.github.com/vkarpov15">github</a></li><li><a href="http://thecodebarbarian.com/feed.xml">rss</a></li><li><a href="/recommendations">recommendations</a></li></ul></div></div><div class="navbar" id="nav"><div class="container"><div class="navbar-header"><a class="navbar-brand big-brand" href="http://thecodebarbarian.com"><img class="logo" src="/images/Barbarian_Head.png"><span class="site-name">The Code Barbarian</span></a></div><div class="navbar-right collapse navbar-collapse" id="home-nav-mobile"><ul class="nav navbar-nav"><li><a href="/tag/mongodb.html">MongoDB</a></li><li><a href="/tag/nodejs.html">NodeJS</a></li><li><a href="/tag/asyncawait.html">Async/Await</a></li><li><a href="/tag/vue.html">Vue</a></li><li class="hidden-md hidden-lg"><a href="#">@code_barbarian</a></li><li class="hidden-md hidden-lg"><a href="#">TCB Github</a></li><li class="hidden-md hidden-lg"><a href="#">TCB Facebook</a></li></ul></div></div></div><div class="container-fluid"><div class="col-lg-3 col-lg-offset-9 right-bar" id="desktop-right-bar"><div class="right-bar-content-slider pull-right"><div class="row recent-posts right-bar-group"><div class="col-lg-12 articles"><p class="right-bar-label">Most Popular Articles</p><ul class="list-unstyled"><li class="right-bar-li"><a href="/common-async-await-design-patterns-in-node.js.html">Common Async/Await Design Patterns in Node.js</a></li><li class="right-bar-li"><a href="/unhandled-promise-rejections-in-node.js.html">Unhandled Promise Rejections in Node.js</a></li><li class="right-bar-li"><a href="/using-async-await-with-mocha-express-and-mongoose">Using Async/Await with Mocha, Express, and Mongoose</a></li><li class="right-bar-li"><a href="/write-your-own-node-js-promise-library-from-scratch.html">Write Your Own Node.js Promise Library from Scratch</a></li><li class="right-bar-li"><a href="/80-20-guide-to-express-error-handling">The 80/20 Guide to Express Error Handling</a></li></ul></div></div><div class="row recent-posts right-bar-group"><div class="col-lg-12 books"><p class="right-bar-label">Ebooks<div><a href="http://asyncawait.net/?utm_source=thecodebarbarian&amp;utm_campaign=sidebar"><img src="/images/verticalbanner.png"></a></div><div><a href="http://es2015generators.com"><img src="https://i.imgur.com/xvGNKlr.png"><p><i>The 80/20 Guide to ES2015 Generators</i></p></a></div><div><script type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&amp;serve=C6AILKT&amp;placement=thecodebarbariancom" id="_carbonads_js"></script></div></p></div></div></div></div></div><div class="container-fluid hidden-sm hidden-md hidden-lg" id="mobile-sharing-options"><div class="row"><div class="col-lg-12"><style>#home-nav-mobile {
  float: left !important;
  margin-left: 215px !important;
}
</style><div class="post-sharing-options"><div class="row"><div class="col-xs-3 twitter-share sharing-option"><a class="social" href="https://twitter.com/share?url=#{encodeURIComponent('http://www.thecodebarbarian.com' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}&amp;via=code_barbarian"><i class="fa fa-twitter"></i></a></div><div class="col-xs-3 facebook-share sharing-option"><a class="social" href="https://www.facebook.com/sharer/sharer.php?u=#{encodeURIComponent('http://www.thecodebarbarian.com/' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}"><i class="fa fa-facebook"></i></a></div><div class="col-xs-3 google-share sharing-option"><a class="social" href="https://plus.google.com/share?url=#{encodeURIComponent('http://www.thecodebarbarian.com/' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}"><i class="fa fa-google-plus"></i></a></div><div class="col-xs-3 comment sharing-option"><a class="social" href="#disqus_thread"><i class="fa fa-comment"></i></a></div></div></div></div></div></div><div class="post-sharing-options hidden-xs pull-left" id="desktop-sharing-options"><ul class="list-unstyled"><li class="twitter-share"><a class="social" href="https://twitter.com/share?url=#{encodeURIComponent('http://www.thecodebarbarian.com' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}&amp;via=code_barbarian"><i class="fa fa-twitter sharing-option"></i></a></li><li class="facebook-share"><a class="social" href="https://www.facebook.com/sharer/sharer.php?u=#{encodeURIComponent('http://www.thecodebarbarian.com/' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}"><i class="fa fa-facebook sharing-option"></i></a></li><li class="google-share"><a class="social" href="https://plus.google.com/share?url=#{encodeURIComponent('http://www.thecodebarbarian.com/' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}"><i class="fa fa-google-plus sharing-option"></i></a></li></ul></div><div class="container"><div class="col-lg-9 post-text"><div class="row"><div class="title-byline-container"><h1 class="post-title">3 Neat Tricks With npm run</h1><div class="credits"><span class="byline">by Valeri Karpov</span><span class="byhandle"><a href="http://www.twitter.com/code_barbarian">@code_barbarian</a></span><span class="bydate">February 05, 2016</span></div></div></div><script type="text/javascript" src="/js/native.js"></script><div><script>
  _native.init("CK7DT53N",{
    targetClass: 'native-inline'
  });
</script>

<div class="native-inline">
  <a href="#native_link#"><span class="sponsor">Sponsor</span> #native_company# - #native_desc#</a>
</div>
</div><div class="post-body-text-container"><p><em>This post originally appeared on <a href="https://strongloop.com/strongblog/3-neat-tricks-with-npm-run/">strongloop.com</a>. StrongLoop provides tools and services for companies developing APIs in Node. <a href="http://www.strongloop.com">Learn more...</a></em></p>
<p>Most Node.js developers use npm as a package manager. However, npm is also
a powerful task runner that can serve as a replacement for gulp. The <code>npm run</code>
command lets you define custom scripts in your <code>package.json</code>, so you can
reduce complex node-related shell scripts into simple one-liners. In this
article, you&#39;ll learn about common <code>npm run</code> use cases, including using
<code>npm run</code> to pipe ES6 browser code through Babel and Browserify.</p>
<h2 id="setting-environment-variables-and-flags">Setting Environment Variables and Flags</h2>
<p>Node.js has several handy configuration options you can set using
environment variables and command line flags (like the old <code>--harmony</code> flag
that you used to enable ES2015 features in 0.12.x). The <code>npm run</code> command,
and <code>npm start</code> in particular, let you set any flags your application needs
before running.</p>
<p>For instance, the <code>NODE_PATH</code> environment variable lets you add additional
directories to the <code>require()</code> function&#39;s module search path. In other words,
suppose your project has a <code>lib</code> directory that contains your source code,
and a <code>test</code>  directory that contains your tests. Let&#39;s say you have a test in
<code>test/e2e/my_feature/my_feature.test.js</code> that wants to <code>require()</code> in a
function that&#39;s declared in <code>lib/server/my_feature/utils.js</code>. That&#39;s going
to involve a brittle <code>require(&#39;../../../lib/server/my_feature_utils&#39;);</code>
command that&#39;ll break every time your directory structure changes. However,
if you run <code>env NODE_PATH=./ node test/e2e/my_feature/my_feature.test.js</code>,
<code>require()</code> will know to look in the current directory, so you can instead use
<code>require(&#39;lib/server/my_feature/utils&#39;);</code>.</p>
<p>Unfortunately, every environment variable and flag you need to set adds
extra complexity to starting your application. Odds are, if you need to set
17 environment variables and flags to start your application, you&#39;re going
to forget one or two. Suppose your application relies on the <code>env NODE_PATH=./</code>
trick as well as
<a href="http://thecodebarbarian.com/2015/04/24/80-20-guide-to-ecmascript-6-proxies">ES2015 proxies</a>,
which are hidden behind the <code>--harmony_proxies</code> flag as of this writing.
You can define a <code>start</code> script in your <code>package.json</code> file as shown below.</p>
<pre><code>{
  <span class="hljs-string">"scripts"</span>: {
    <span class="hljs-string">"start"</span>: <span class="hljs-string">"env NODE_PATH=./ node --harmony_proxies index.js"</span>
  }
}</code></pre><p>Now, if you run <code>npm start</code> (which is just short for <code>npm run start</code>), npm
will run the <code>start</code> script for you and start your application with your special
configuration options.</p>
<h2 id="command-line-shortcuts">Command Line Shortcuts</h2>
<p>Let&#39;s face it,
<a href="http://thecodebarbarian.com/2015/02/27/npm-install--g">asking users to <code>npm install -g</code> (usually) sucks</a>. You may have
heard that the upcoming gulp 4.0 release will be entirely incompatible with
gulp 3.x. Since many people install gulp globally and there&#39;s
no way for <code>package.json</code> to enforce globally-installed packages, a lot of
users are going to end up playing a guessing game as to which version of
gulp they need.</p>
<p>It&#39;s much better to list gulp as a <code>devDependency</code> in
<code>package.json</code>, but then you have to run <code>./node_modules/.bin/gulp watch</code>
rather than <code>gulp watch</code>, which is a pain. That&#39;s where <code>npm run</code> comes in;
it adds <code>./node_modules/.bin</code> to your <code>PATH</code>. In other words, if you list
gulp 3.8 as a <code>devDependency</code>, you can access the <code>gulp</code> executable in
your <code>package.json</code> scripts without asking your users to <code>npm install gulp -g</code>.</p>
<pre><code>{
  <span class="hljs-string">"scripts"</span>: {
    <span class="hljs-string">"watch"</span>: <span class="hljs-string">"gulp watch"</span>
  }
}</code></pre><p>Now, <code>npm run watch</code> is a handy shortcut for <code>./node_modules/.bin/gulp watch</code>.
You can do the same thing with mocha.</p>
<pre><code>{
  <span class="hljs-string">"scripts"</span>: {
    <span class="hljs-string">"test"</span>: <span class="hljs-string">"mocha -r nyan test/*.test.js"</span>
  }
}</code></pre><p>Now <code>npm test</code> (which is the same as <code>npm run test</code>) is a handy shortcut for
running all your mocha tests in your <code>test</code> directory using the nyan cat
reporter.</p>
<p>The mocha executable also has some neat command line flags. For instance, the
<code>--grep</code> (or <code>-g</code> for short) mocha flag lets you only run tests whose names
match the given regular expression. In npm &gt;= 2.14.0, you can use <code>--</code> to
pass extra flags to mocha. For instance, the below commands are equivalent.</p>
<pre><code># This command...
npm test -- -g &quot;login.*fails&quot;
# is the same thing as this one
./node_modules/.bin/mocha -r nyan test/*.test.js -g &quot;login.*fails&quot;</code></pre><h2 id="an-alternative-to-gulp">An Alternative to Gulp</h2>
<p>Gulp is a powerful streaming build system that lets you parallelize
compiling your files. It&#39;s a great tool, but it can be overkill for some
applications, especially if your team doesn&#39;t have much experience with
Node.js streams. The <code>npm run</code> command can serve as a less-performant
replacement for gulp in many use cases. For instance, suppose you have
some ES2015 code in <code>example.js</code> that you want to transpile with babel and
then pipe into browserify for use in the browser.</p>
<pre><code class="language-javascript"><span class="hljs-meta">'use strict'</span>;

<span class="hljs-keyword">const</span> co = <span class="hljs-built_in">require</span>(<span class="hljs-string">'co'</span>);

co(<span class="hljs-function"><span class="hljs-keyword">function</span>*(<span class="hljs-params"></span>) </span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Hello, world!'</span>);
});</code></pre>
<p>If you wanted to use gulp to compile this, you&#39;d probably use the <code>gulp-babel</code>
and <code>gulp-browserify</code> npm modules, which wrap babel and browserify for gulp.
However, babel and browserify have command line interfaces, so you can
compile this file using Unix-style pipes. Note that the below example
requires babel 5.x, it won&#39;t work with babel 6.</p>
<pre><code>./node_modules/.bin/browserify example.js | ./node_modules/.bin/babel &gt; ./bin/example.js</code></pre><p>Once again, the <code>./node_modules/.bin</code> part is annoying. Thankfully, if
you define a <code>compile</code> script in <code>package.json</code>, you can just achieve the
same result with <code>npm run compile</code>.</p>
<pre><code>{
  <span class="hljs-string">"scripts"</span>: {
    <span class="hljs-string">"compile"</span>: <span class="hljs-string">"browserify example.js | babel &gt; ./bin/example.js"</span>
  }
}</code></pre><h2 id="closing-thoughts">Closing Thoughts</h2>
<p>The <code>npm run</code> command lets npm function as a versatile task runner in addition
to a task manager. Good node.js applications leverage <code>npm start</code> and
<code>npm test</code> to make it explicit how to run your application and how to test it.
Also, <code>npm run</code> makes including executable npm modules
(gulp, mocha, karma, etc.) as <code>devDependencies</code> more convenient. You can
even leverage <code>npm run</code> and Unix streams to run your build processes without
the help of a build system like gulp or grunt. Conceptually, <code>npm run</code> and
the <code>scripts</code> section in <code>package.json</code> should define how to do the most
common command-line tasks for your application, like starting the application,
testing it, and running any transpilers.</p>
</div><div style="color: #666666; border-top: 1px dashed #666666; margin: 25px; text-align: center; padding-top: 10px"><em>Found a typo or error? Open up a pull request! This post is
available as markdown on&nbsp;<a href="https://github.com/vkarpov15/thecodebarbarian.com/blob/master/lib/posts/#{post.src.substr('./lib/posts/'.length)}">Github</a></em></div><div id="disqus_thread"></div><script type="text/javascript">/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'codebarbarian'; // required: replace example with your forum shortname

/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><a class="dsq-brlink" href="http://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a></div></div><div style="padding-bottom: 100px">&nbsp;</div><script type="text/javascript">var xhr = new XMLHttpRequest();
xhr.open('POST', 'https://g0a3nbw0xa.execute-api.us-east-1.amazonaws.com/prod/track', true);
xhr.setRequestHeader('Content-Type', 'application/json');
xhr.onreadystatechange = function() {};
xhr.send(JSON.stringify({
  path: window.location.pathname,
  hostname: window.location.hostname
}));</script><link rel="stylesheet" href="/style/inlinecpc.css"></body></html>