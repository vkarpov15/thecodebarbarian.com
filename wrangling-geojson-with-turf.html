<!DOCTYPE html><html><head><script type="text/javascript">var _sf_startpt=(new Date()).getTime()
</script><title>Wrangling GeoJSON with Turf.js | www.thecodebarbarian.com</title><meta name="viewport" content="width=device-width, initial-scale=1"><link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Merriweather:400,400italic,600,700" rel="stylesheet" type="text/css"><link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"><link href="/style/style.css" rel="stylesheet" type="text/css"><link href="/style/github.css" rel="stylesheet" type="text/css"><script href="http://code.jquery.com/jquery-2.1.1.min.js" type="text/javascript"></script><script href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js" type="text/javascript"></script><script href="/javascript/sidebar.js" type="text/javascript"></script><meta property="og:title" content="Wrangling GeoJSON with Turf.js"><meta property="og:url" content="http://www.thecodebarbarian.com/wrangling-geojson-with-turf"><meta property="og:image" content="https://i.imgur.com/6kP4Bcm.jpg"><meta property="og:site_name" content="The Code Barbarian"><meta property="description" content="[Turf.js](http://turfjs.org/) has become an indispensible part of my Node.js"><meta name="twitter:image" content="https://i.imgur.com/6kP4Bcm.jpg"></head><body><div class="navbar social-links hidden-sm hidden-xs"><div class="container"><ul class="nav navbar-nav navbar-right"><li><a href="http://www.twitter.com/code_barbarian">twitter</a></li><li><a href="http://www.github.com/vkarpov15">github</a></li><li><a href="http://thecodebarbarian.com/feed.xml">rss</a></li><li><a href="/recommendations">recommendations</a></li></ul></div></div><div class="navbar" id="nav"><div class="container"><div class="navbar-header"><a class="navbar-brand big-brand" href="http://thecodebarbarian.com"><img class="logo" src="/images/Barbarian_Head.png"><span class="site-name">The Code Barbarian</span></a></div><div class="navbar-right collapse navbar-collapse" id="home-nav-mobile"><ul class="nav navbar-nav"><li><a href="/tag/mongodb.html">MongoDB</a></li><li><a href="/tag/nodejs.html">NodeJS</a></li><li><a href="/tag/asyncawait.html">Async/Await</a></li><li><a href="/tag/vue.html">Vue</a></li><li class="hidden-md hidden-lg"><a href="#">@code_barbarian</a></li><li class="hidden-md hidden-lg"><a href="#">TCB Github</a></li><li class="hidden-md hidden-lg"><a href="#">TCB Facebook</a></li></ul></div></div></div><div class="container-fluid"><div class="col-lg-3 col-lg-offset-9 right-bar" id="desktop-right-bar"><div class="right-bar-content-slider pull-right"><div class="row recent-posts right-bar-group"><div class="col-lg-12 articles"><p class="right-bar-label">Most Popular Articles</p><ul class="list-unstyled"><li class="right-bar-li"><a href="/common-async-await-design-patterns-in-node.js.html">Common Async/Await Design Patterns in Node.js</a></li><li class="right-bar-li"><a href="/unhandled-promise-rejections-in-node.js.html">Unhandled Promise Rejections in Node.js</a></li><li class="right-bar-li"><a href="/using-async-await-with-mocha-express-and-mongoose">Using Async/Await with Mocha, Express, and Mongoose</a></li><li class="right-bar-li"><a href="/write-your-own-node-js-promise-library-from-scratch.html">Write Your Own Node.js Promise Library from Scratch</a></li><li class="right-bar-li"><a href="/80-20-guide-to-express-error-handling">The 80/20 Guide to Express Error Handling</a></li></ul></div></div><div class="row recent-posts right-bar-group"><div class="col-lg-12 books"><p class="right-bar-label">Ebooks<div><a href="http://asyncawait.net/?utm_source=thecodebarbarian&amp;utm_campaign=sidebar"><img src="/images/verticalbanner.png"></a></div><div><a href="http://es2015generators.com"><img src="https://i.imgur.com/xvGNKlr.png"><p><i>The 80/20 Guide to ES2015 Generators</i></p></a></div><div><script type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&amp;serve=C6AILKT&amp;placement=thecodebarbariancom" id="_carbonads_js"></script></div></p></div></div></div></div></div><div class="container-fluid hidden-sm hidden-md hidden-lg" id="mobile-sharing-options"><div class="row"><div class="col-lg-12"><style>#home-nav-mobile {
  float: left !important;
  margin-left: 215px !important;
}
</style><div class="post-sharing-options"><div class="row"><div class="col-xs-3 twitter-share sharing-option"><a class="social" href="https://twitter.com/share?url=#{encodeURIComponent('http://www.thecodebarbarian.com' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}&amp;via=code_barbarian"><i class="fa fa-twitter"></i></a></div><div class="col-xs-3 facebook-share sharing-option"><a class="social" href="https://www.facebook.com/sharer/sharer.php?u=#{encodeURIComponent('http://www.thecodebarbarian.com/' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}"><i class="fa fa-facebook"></i></a></div><div class="col-xs-3 google-share sharing-option"><a class="social" href="https://plus.google.com/share?url=#{encodeURIComponent('http://www.thecodebarbarian.com/' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}"><i class="fa fa-google-plus"></i></a></div><div class="col-xs-3 comment sharing-option"><a class="social" href="#disqus_thread"><i class="fa fa-comment"></i></a></div></div></div></div></div></div><div class="post-sharing-options hidden-xs pull-left" id="desktop-sharing-options"><ul class="list-unstyled"><li class="twitter-share"><a class="social" href="https://twitter.com/share?url=#{encodeURIComponent('http://www.thecodebarbarian.com' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}&amp;via=code_barbarian"><i class="fa fa-twitter sharing-option"></i></a></li><li class="facebook-share"><a class="social" href="https://www.facebook.com/sharer/sharer.php?u=#{encodeURIComponent('http://www.thecodebarbarian.com/' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}"><i class="fa fa-facebook sharing-option"></i></a></li><li class="google-share"><a class="social" href="https://plus.google.com/share?url=#{encodeURIComponent('http://www.thecodebarbarian.com/' + post.dest.directory.substr('./bin'.length) + '/' + post.dest.name)}"><i class="fa fa-google-plus sharing-option"></i></a></li></ul></div><div class="container"><div class="col-lg-9 post-text"><div class="row"><div class="title-byline-container"><h1 class="post-title">Wrangling GeoJSON with Turf.js</h1><div class="credits"><span class="byline">by Valeri Karpov</span><span class="byhandle"><a href="http://www.twitter.com/code_barbarian">@code_barbarian</a></span><span class="bydate">December 01, 2017</span></div></div></div><script type="text/javascript" src="/js/native.js"></script><div><script>
  _native.init("CK7DT53N",{
    targetClass: 'native-inline'
  });
</script>

<div class="native-inline">
  <a href="#native_link#"><span class="sponsor">Sponsor</span> #native_company# - #native_desc#</a>
</div>
</div><div class="post-body-text-container"><p><a href="http://turfjs.org/">Turf.js</a> has become an indispensible part of my Node.js
workflow over the last couple years. Turf brings an unparalleled level of
sophistication to geospatial data, I haven&#39;t seen any library in any other
language that makes working with <a href="http://geojson.org/">GeoJSON</a> quite as easy.
Turf and Node.js also work nicely with <a href="http://thecodebarbarian.com/80-20-guide-to-mongodb-geospatial-queries">MongoDB</a>, so you can leverage MongoDB to handle <a href="/a-practical-introduction-to-geojson-with-node-js.html">GeoJSON</a> data that&#39;s too big to fit in memory and then do additional processing in Node.js with Turf.
Much like how <a href="http://www.numpy.org/">numpy</a> and <a href="https://www.scipy.org/">scipy</a>
made Python a go-to language for number crunching, I think Turf makes Node.js
the go-to for geospatial.</p>
<p>Geospatial is hard, and even massive companies whose businesses are built on geospatial data don&#39;t always do it well, like Uber. Below is Uber&#39;s
polygon describing what parts of the San Francisco Bay Area are not eligible for
<a href="http://www.fareestimate.com/news/flat-fares/">flat fare rides</a>. Clearly a
candidate for a <a href="https://tools.ietf.org/html/rfc7946#section-3.1.7">MultiPolygon</a>
but odds are some part of Uber&#39;s stack doesn&#39;t support it.</p>
<img src="https://i.imgur.com/FJDF3Pc.png" style="height: 500px">

<h2 id="which-points-are-within-a-polygon">Which Points are Within a Polygon?</h2>
<p>GeoJSON has several fundamental data structures, but this article will
only consider features, points, lines, and polygons. A <em>point</em> is a single latitude
and longitude coordinate pair that represents a single point on the Earth.
An example GeoJSON point is shown below.</p>
<pre><code class="language-javascript">{ type: <span class="hljs-string">'Point'</span>, coordinates: [ <span class="hljs-number">-122.95</span>, <span class="hljs-number">50.12</span> ] } }</code></pre>
<p>A <em>polygon</em> is a list of points defining a shape on a map. Below is a sample
GeoJSON polygon that approximately represents the US state of Colorado.</p>
<pre><code class="language-javascript">{ type: <span class="hljs-string">'Polygon'</span>,
  coordinates:
   [ [ [ <span class="hljs-number">-109</span>, <span class="hljs-number">41</span> ],
       [ <span class="hljs-number">-102</span>, <span class="hljs-number">41</span> ],
       [ <span class="hljs-number">-102</span>, <span class="hljs-number">37</span> ],
       [ <span class="hljs-number">-109</span>, <span class="hljs-number">37</span> ],
       [ <span class="hljs-number">-109</span>, <span class="hljs-number">41</span> ] ] ] }</code></pre>
<p>A <em>line</em> is a list of coordinates representing a line on the map. For example, below is a GeoJSON line that represents the boundary of the Colorado polygon above.</p>
<pre><code class="language-javascript">{ type: <span class="hljs-string">'LineString'</span>,
  coordinates:
   [ [ <span class="hljs-number">-109</span>, <span class="hljs-number">41</span> ],
     [ <span class="hljs-number">-102</span>, <span class="hljs-number">41</span> ],
     [ <span class="hljs-number">-102</span>, <span class="hljs-number">37</span> ],
     [ <span class="hljs-number">-109</span>, <span class="hljs-number">37</span> ],
     [ <span class="hljs-number">-109</span>, <span class="hljs-number">41</span> ] ] }</code></pre>
<p>A <em>feature</em> is a wrapper object that contains a point, line or polygon in its <code>geometry</code> property. Below is a feature that wraps the above polygon.</p>
<pre><code class="language-javascript">{ type: <span class="hljs-string">'Feature'</span>,
  properties: {},
  geometry:
   { type: <span class="hljs-string">'Polygon'</span>,
     coordinates:
      [ [ [ <span class="hljs-number">-109</span>, <span class="hljs-number">41</span> ],
          [ <span class="hljs-number">-102</span>, <span class="hljs-number">41</span> ],
          [ <span class="hljs-number">-102</span>, <span class="hljs-number">37</span> ],
          [ <span class="hljs-number">-109</span>, <span class="hljs-number">37</span> ],
          [ <span class="hljs-number">-109</span>, <span class="hljs-number">41</span> ] ] ] } }</code></pre>
<p>Generally, Turf prefers to use features rather than points or polygons. The
<a href="https://www.npmjs.com/package/@turf/helpers"><code>@turf/helpers</code> npm package</a> contains helpers for creating point and polygon features. Below is an example of creating a polygon feature representing the state of Colorado and 4 point features representing North American ski destinations.</p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> { point, polygon } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'@turf/helpers'</span>);

<span class="hljs-comment">// Rough approximation of the state of Colorado, see:</span>
<span class="hljs-comment">// http://i.imgur.com/59OCqJR.jpg</span>
<span class="hljs-comment">// Note the triple-nested array.</span>
<span class="hljs-keyword">const</span> colorado = polygon([[
  [<span class="hljs-number">-109</span>, <span class="hljs-number">41</span>],
  [<span class="hljs-number">-102</span>, <span class="hljs-number">41</span>],
  [<span class="hljs-number">-102</span>, <span class="hljs-number">37</span>],
  [<span class="hljs-number">-109</span>, <span class="hljs-number">37</span>],
  [<span class="hljs-number">-109</span>, <span class="hljs-number">41</span>]
]]);

<span class="hljs-comment">// Approximate coordinates of 4 ski destinations in North America.</span>
<span class="hljs-comment">// Only Aspen is in the state of Colorado</span>
<span class="hljs-keyword">const</span> squaw = point([<span class="hljs-number">-120.24</span>, <span class="hljs-number">39.21</span>]);
<span class="hljs-keyword">const</span> mammoth = point([<span class="hljs-number">-118.9</span>, <span class="hljs-number">37.61</span>]);
<span class="hljs-keyword">const</span> aspen = point([<span class="hljs-number">-106.82</span>, <span class="hljs-number">39.18</span>]);
<span class="hljs-keyword">const</span> whistler = point([<span class="hljs-number">-122.95</span>, <span class="hljs-number">50.12</span>]);</code></pre>
<p>Here&#39;s how these features look on a map. Click on the map for an interactive
view.</p>
<a href="http://bl.ocks.org/anonymous/raw/a297439e02cad4ae5c41ed9e1d89b344/">
<img src="http://i.imgur.com/59OCqJR.jpg" />
</a>

<p>How do you determine which of these points is within the polygon? You can use the <a href="https://www.npmjs.com/package/@turf/inside"><code>@turf/inside</code> npm package</a>, which returns <code>true</code> if the given point is within the polygon, and <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/filter"><code>filter()</code> over an array</a> of the 4 points.</p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> inside = <span class="hljs-built_in">require</span>(<span class="hljs-string">'@turf/inside'</span>);

<span class="hljs-keyword">const</span> inColorado = [squaw, mammoth, aspen, whistler].filter(point =&gt; inside(point, colorado));
<span class="hljs-comment">// `[ [-106.82, 39.18] ]`, corresponds to Aspen</span>
<span class="hljs-built_in">console</span>.log(inColorado.map(point =&gt; point.geometry.coordinates));</code></pre>
<p>Determining whether a point is within a polygon is one of the most common geospatial computing tasks. For example, the gross Uber polygon in the introduction is used to determine whether a point (your current position) is within an area that isn&#39;t eligible for flat fares (the polygon that contains the major Bay Area airports).</p>
<h2 id="sort-points-by-distance-from-a-point">Sort Points By Distance from A Point</h2>
<p>Another common geospatial computing task is determining the distance between two points, or, more generally, ordering points based on their distance from a point.
The <a href="https://www.npmjs.com/package/@turf/distance"><code>@turf/distance</code> npm package</a> computes the distance between two points. Here&#39;s how you use Turf&#39;s <code>distance()</code>
function to sort the 4 ski destinations based on their distance from San Francisco.</p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> { point, polygon } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'@turf/helpers'</span>);
<span class="hljs-keyword">const</span> distance = <span class="hljs-built_in">require</span>(<span class="hljs-string">'@turf/distance'</span>);

<span class="hljs-comment">// Approximate coordinates of 4 ski destinations in North America.</span>
<span class="hljs-keyword">const</span> squaw = point([<span class="hljs-number">-120.24</span>, <span class="hljs-number">39.21</span>]);
<span class="hljs-keyword">const</span> mammoth = point([<span class="hljs-number">-118.9</span>, <span class="hljs-number">37.61</span>]);
<span class="hljs-keyword">const</span> aspen = point([<span class="hljs-number">-106.82</span>, <span class="hljs-number">39.18</span>]);
<span class="hljs-keyword">const</span> whistler = point([<span class="hljs-number">-122.95</span>, <span class="hljs-number">50.12</span>]);

<span class="hljs-comment">// Approximate coordinates of San Francisco</span>
<span class="hljs-keyword">const</span> sf = point([<span class="hljs-number">-122.5</span>, <span class="hljs-number">37.7</span>]);

<span class="hljs-keyword">const</span> points = [whistler, aspen, mammoth, squaw];
<span class="hljs-comment">// Units don't matter for this case, but turf uses kilometers by default</span>
points.sort((p1, p2) =&gt; distance(p1, sf) - distance(p2, sf));

<span class="hljs-comment">// Prints the 4 points in the order they were declared, because that's</span>
<span class="hljs-comment">// the correct sort order:</span>
<span class="hljs-comment">// [ [ -120.24, 39.21 ],</span>
<span class="hljs-comment">//   [ -118.9, 37.61 ],</span>
<span class="hljs-comment">//   [ -106.82, 39.18 ],</span>
<span class="hljs-comment">//   [ -122.95, 50.12 ] ]</span>
<span class="hljs-built_in">console</span>.log(points.map(point =&gt; point.geometry.coordinates));</code></pre>
<h2 id="distance-from-point-to-polygon">Distance from Point to Polygon</h2>
<p>Checking if a point is in a polygon and finding the distance between two points are both fairly simple. Let&#39;s do something more sophisticated: what&#39;s the distance between a polygon and a point outside the polygon? For example, with the above data set, how far is Mammoth Lakes from the border of Colorado?</p>
<p>Since Mammoth Lakes is not in Colorado, the distance between Mammoth Lakes and Colorado is the same thing as the distance between Mammoth Lakes and the border of Colorado. Turf has a handy <a href="http://turfjs.org/docs#polygonToLine"><code>polygonToLine()</code> function</a> that converts a polygon to a line, so you can convert the Colorado polygon to a line representing the border of Colorado. Then, you can use the <a href="http://turfjs.org/docs#pointToLineDistance"><code>pointToLineDistance()</code> function</a> that computes the distance from a point to a line. Here&#39;s how you combine these two functions to compute the distance from Mammoth Lakes to Colorado:</p>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> { point, polygon } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'@turf/helpers'</span>);
<span class="hljs-keyword">const</span> pointToLineDistance = <span class="hljs-built_in">require</span>(<span class="hljs-string">'@turf/point-to-line-distance'</span>);
<span class="hljs-keyword">const</span> polygonToLine = <span class="hljs-built_in">require</span>(<span class="hljs-string">'@turf/polygon-to-line'</span>);

<span class="hljs-comment">// Rough approximation of the state of Colorado, see:</span>
<span class="hljs-comment">// http://i.imgur.com/59OCqJR.jpg</span>
<span class="hljs-keyword">const</span> colorado = polygon([[
  [<span class="hljs-number">-109</span>, <span class="hljs-number">41</span>],
  [<span class="hljs-number">-102</span>, <span class="hljs-number">41</span>],
  [<span class="hljs-number">-102</span>, <span class="hljs-number">37</span>],
  [<span class="hljs-number">-109</span>, <span class="hljs-number">37</span>],
  [<span class="hljs-number">-109</span>, <span class="hljs-number">41</span>]
]]);

<span class="hljs-keyword">const</span> mammoth = point([<span class="hljs-number">-118.9</span>, <span class="hljs-number">37.61</span>]);

<span class="hljs-comment">// Mammoth Lakes is ~545 miles from the border of Colorado</span>
<span class="hljs-built_in">console</span>.log(pointToLineDistance(mammoth, polygonToLine(colorado), { units: <span class="hljs-string">'miles'</span> }));</code></pre>
<h2 id="moving-on">Moving On</h2>
<p>Turf makes Node.js a natural choice for working with GeoJSON. The above use cases are just the tip of the iceberg of what Turf offers. Writing your own logic to calculate the distance between two points isn&#39;t too hard, but Turf can do some very complex calculations for you, like <a href="http://turfjs.org/docs#convex">convex hulls</a>, <a href="http://turfjs.org/docs#lineIntersect">line intersection</a>, <a href="http://turfjs.org/docs#voronoi">Voronoi diagrams</a>, and <a href="http://turfjs.org/docs#area">areas</a>. The Turf team is adding new functionality regularly: I previously implemented <a href="https://en.wikipedia.org/wiki/DBSCAN">DBSCAN clustering</a> on top of Turf for an internal project, and they&#39;ve since <a href="https://www.npmjs.com/package/@turf/clusters-dbscan">added their own implementation</a>. Check out Turf if you find yourself dealing with geospatial data, it will enable you to do some incredible things with geospatial data.</p>
<p><em>Like this article? <a href="https://www.patreon.com/codebarbarian">Subscribe on Patreon</a> to get access to exclusive in-depth articles on Node.js</em></p>
<div style="text-align: center"><a href="https://www.patreon.com/codebarbarian"><img src="https://i.imgur.com/48Z01Md.png"></a></div>
</div><div style="color: #666666; border-top: 1px dashed #666666; margin: 25px; text-align: center; padding-top: 10px"><em>Found a typo or error? Open up a pull request! This post is
available as markdown on&nbsp;<a href="https://github.com/vkarpov15/thecodebarbarian.com/blob/master/lib/posts/#{post.src.substr('./lib/posts/'.length)}">Github</a></em></div><div id="disqus_thread"></div><script type="text/javascript">/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'codebarbarian'; // required: replace example with your forum shortname

/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><a class="dsq-brlink" href="http://disqus.com">comments powered by <span class="logo-disqus">Disqus</span></a></div></div><div style="padding-bottom: 100px">&nbsp;</div><script type="text/javascript">var xhr = new XMLHttpRequest();
xhr.open('POST', 'https://g0a3nbw0xa.execute-api.us-east-1.amazonaws.com/prod/track', true);
xhr.setRequestHeader('Content-Type', 'application/json');
xhr.onreadystatechange = function() {};
xhr.send(JSON.stringify({
  path: window.location.pathname,
  hostname: window.location.hostname
}));</script><link rel="stylesheet" href="/style/inlinecpc.css"></body></html>